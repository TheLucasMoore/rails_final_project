<%= render '/recipes/recipe' %>
<%= render 'comments' %>

<br><br>
<%= render 'form' %>

<% content_for :comments do %>
<script>
  $(function() {
    editMethods();
    deleteMethods();
    submitEdits();
  })

  var editMethods = function() {
    $('a#edit').on("click", function(event) {
      event.preventDefault();
      console.log(event);
      $('#edit_comment_form').show();
      $('#comment_content').hide();
    });
  }

  function submitEdits() {
    $('#edit_comment_form').on("submit", function(event) {
      event.preventDefault();
      var values = $(this).serialize();
      ajaxEdit(event, values);
      $(this).hide();
    })
  };

  function ajaxEdit(event, values) {
    var comment = event['currentTarget']['0']['value'];
    var user_id = event['currentTarget']['1']['value'];
    var recipe_id = event['currentTarget']['2']['value'];
    var id = event['currentTarget']['3']['value'];
    
    $.ajax ({
        url: "http://localhost:3000/recipes/" + recipe_id + "/comments/" + id + ".json",
        method: 'patch',
        dataType: 'json',
        data: values
      }).done(handleResponse(comment, id));
  };

  function handleResponse(comment, id) {
    $('#edit_comment_form').hide();
    $('.commentos-' + id).text(comment);
    $('#comment_content').show();
  }

  var deleteMethods = function() {
    $('a#delete').on("click", function(event) {
      event.preventDefault();
      var url = event['target']['href'];
      var result = confirm("Are you sure?");
      if(result) {
        $.ajax({
          url: url,
          method: 'delete'
        }).done(deleteResponse(event));
      }
    });
  }

  var deleteResponse = function(event) {
    var comment = event['target']['parentElement'];
    $(comment).text("Comment Deleted");
    console.log(event);
  }

</script>
<% end %>